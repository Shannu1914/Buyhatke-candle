<%- include('partials/header', { title: 'My Dashboard', active: 'user' }) %>

<section class="user-dashboard container" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); padding: 100px 60px; border-radius: 12px;">

  <h1 style="margin-bottom: 30px; font-size: 2rem; font-weight: 700; color: #333;">Welcome, <%= user.name %> ðŸ‘‹</h1>

  <!-- Dashboard Tabs -->
  <div class="dashboard-tabs" style="display:flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap;">
    <button onclick="showTab('orders')" class="btn btn-primary">My Orders</button>
    <button onclick="showTab('returns')" class="btn btn-outline">Returns / Refunds</button>
    <button onclick="showTab('profile')" class="btn btn-secondary">Profile</button>
  </div>

  <!-- Orders Tab -->
  <div id="orders" class="tab-content">
    <h2 style="margin-bottom: 20px;">Previous & Ongoing Orders</h2>
    <% if (!orders || orders.length === 0) { %>
      <p>No orders yet.</p>
    <% } else { %>
      <div class="table-responsive">
        <table class="dashboard-table" style="width:100%; border-collapse: collapse; background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
          <thead style="background: #ff6600; color: #fff;">
            <tr>
              <th style="padding:12px;">Order ID</th>
              <th style="padding:12px;">Date</th>
              <th style="padding:12px;">Status</th>
              <th style="padding:12px;">Total</th>
              <th style="padding:12px;">Action</th>
            </tr>
          </thead>
          <tbody>
            <% orders.forEach(order => { %>
              <tr style="border-bottom: 1px solid #eee;">
                <td style="padding:10px;"><%= order._id %></td>
                <td style="padding:10px;"><%= order.createdAt?.toDateString() || 'N/A' %></td>
                <td style="padding:10px;"><%= order.status %></td>
                <td style="padding:10px;">â‚¹<%= order.total %></td>
                <td style="padding:10px;">
                  <% if(order.status === 'Delivered') { %>
                    <a href="/user/orders/<%= order._id %>/return" class="btn btn-secondary" style="padding:6px 12px; font-size:0.9rem;">Return / Refund</a>
                  <% } else { %>
                    <span>-</span>
                  <% } %>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>

  <!-- Returns Tab -->
  <div id="returns" class="tab-content" style="display:none;">
    <h2 style="margin-bottom:20px;">Return / Refund Requests</h2>
    <% if (!returns || returns.length === 0) { %>
      <p>No requests submitted.</p>
    <% } else { %>
      <div class="return-cards" style="display:flex; flex-direction:column; gap:15px;">
        <% returns.forEach(req => { %>
          <div style="background:#fff; padding:15px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.08);">
            <p><strong>Order:</strong> <%= req.orderId %> | <strong>Status:</strong> <%= req.status %></p>
          </div>
        <% }) %>
      </div>
    <% } %>
  </div>

  <!-- Profile Tab -->
  <div id="profile" class="tab-content" style="display:none;">
    <h2 style="margin-bottom:20px;">My Profile</h2>
    <div class="profile-card" style="background:#fff; padding:25px; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.1); display:flex; flex-wrap: wrap; gap:25px; align-items:center;">
      <img src="<%= user.profileImage || '/images/default-profile.png' %>" alt="Profile Photo" class="profile-photo" style="width:160px; height:160px; border-radius:50%; border:4px solid #ff6600; object-fit:cover;"/>
      <div class="profile-info">
        <div class="profile-photo-container">
          <img src="<%= user.profileImage || '/images/default-profile.png' %>" alt="Profile Photo" class="profile-photo" />
          <form action="/user/profile/upload" method="POST" enctype="multipart/form-data" class="profile-upload-form">
            <input type="file" name="profileImage" accept="image/*" required />
            <button type="submit" class="btn btn-upload-overlay">ðŸ“· Change</button>
          </form>
        </div>

        <h2 class="profile-name"><%= user.name %></h2>
        <p class="profile-role"><%= user.isAdmin ? 'Administrator' : 'User' %></p>
      </div>

      <div style="flex:1; min-width:220px;">
        <h2 class="profile-name" style="font-size:1.6rem; font-weight:700; color:#333;"><%= user.name %></h2>
        <p class="profile-role" style="color:#555; margin-bottom:15px;"><%= user.isAdmin ? 'Administrator' : 'User' %></p>

        <div class="profile-details" style="font-size:1rem; color:#444;">
          <p><strong>Email:</strong> <%= user.email %></p>
          <p><strong>Joined:</strong> <%= user.createdAt?.toDateString() || 'N/A' %></p>
        </div>

        <a href="/user/profile" class="btn btn-outline" style="margin-top:15px;">Edit Profile</a>
      </div>
    </div>
  </div>
</section>

<script>
  function showTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
    document.getElementById(tabId).style.display = 'block';
  }
</script>

<%- include('partials/footer') %>
