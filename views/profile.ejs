<%- include('partials/header') %>

<section class="auth-section">
  <div class="auth-card profile-card">
    <h1>My Profile</h1>

    <div class="profile-info">  
      <div class="profile-photo-container">
        <img src="<%= user.profileImage || '/uploads/profiles/default-profile.png' %>"  alt="Profile Photo" class="profile-photo" />
        <form action="/user/profile/upload" method="POST" enctype="multipart/form-data" class="profile-upload-form">
          <input type="file" name="profileImage" accept="image/*" id="profileImageInput" hidden />
          <button type="button" class="btn btn-upload-overlay" onclick="document.getElementById('profileImageInput').click();">ğŸ“· Change</button>
        </form>
      </div>

      <h2 class="profile-name"><%= user.name %></h2>
      <p class="profile-role"><%= user.isAdmin ? 'Administrator' : 'User' %></p>

      <div class="profile-details">
        <p><strong>Email:</strong> <%= user.email %></p>
        <p><strong>Joined:</strong> <%= user.createdAt ? user.createdAt.toDateString() : 'N/A' %></p>
      </div>

      <div class="profile-actions" style="margin-top: 20px; display:flex; gap:10px;">
        <!-- Delete Profile Image -->
        <form action="/user/profile/delete-image" method="POST">
          <button type="submit" class="btn btn-danger">ğŸ—‘ Delete Profile Picture</button>
        </form>

        <!-- Delete Account -->
        <form action="/user/delete-account" method="POST" onsubmit="return confirm('Are you sure you want to delete your account? This cannot be undone.')">
          <button type="submit" class="btn btn-danger">âŒ Delete Account</button>
        </form>
      </div>

      <a href="/user/dashboard" class="btn btn-outline">Back to Dashboard</a>
    </div>
  </div>

  <% if (locals.success_msg) { %>
    <div class="alert alert-success"><%= success_msg %></div>
  <% } %>
  <% if (locals.error_msg) { %>
    <div class="alert alert-danger"><%= error_msg %></div>
  <% } %>
  
</section>

<script>
  const profileInput = document.getElementById('profileImageInput');
  const profileForm = document.querySelector('.profile-upload-form');

  profileInput.addEventListener('change', () => {
    if(profileInput.files.length > 0){
      profileForm.submit(); // submit form automatically
    }
  });
</script>
<%- include('partials/footer') %>
