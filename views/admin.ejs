<%- include('partials/header', { title: 'Admin Dashboard', active: 'admin' }) %>

<section class="admin-dashboard">
  <div class="admin-overlay"></div>
  <div class="admin-container">
    <h1>Admin Dashboard</h1>

    <div class="dashboard-grid">

      <!-- Stats Card -->
      <div class="card">
        <h2>Statistics</h2>
        <ul>
          <li><strong>Users:</strong> <%= stats.users %></li>
          <li><strong>Articles:</strong> <%= stats.articles %></li>
          <li><strong>Certificates:</strong> <%= stats.certificates %></li>
          <li><strong>Invoices:</strong> <%= stats.invoices %></li>
        </ul>
      </div>

      <!-- Users Card -->
      <div class="card">
        <h2>Manage Users</h2>

        <!-- üîç Search Form -->
        <form method="GET" action="/admin" style="margin-bottom: 10px;">
          <input type="text" name="search" placeholder="Search users..." value="<%= search %>" />
          <button type="submit">Search</button>
        </form>
        
        <ul>
          <% users.forEach(user => { %>
            <li><%= user.name %> - <%= user.email %> - <%= user.isAdmin ? 'Admin' : 'User' %></li>
          <% }) %>
        </ul>
      </div>

      <!-- Articles Card -->
      <div class="card">
        <h2>Manage Articles</h2>
        <ul>
          <% articles.forEach(article => { %>
            <li>
              <h3><%= article.title %> by <%= article.author %></h3>
              <a href="/admin/download/<%= article.filename %>">Download</a>
              <% if (article.status === 'pending') { %>
                <form method="POST" action="/admin/articles/<%= article._id %>/approve" style="display:inline;">
                  <button type="submit" class="btn btn-approve">Approve</button>
                </form>
                <form method="POST" action="/admin/articles/<%= article._id %>/decline" style="display:inline; margin-left:10px;">
                  <button type="submit" class="btn btn-decline">Decline</button>
                </form>
              <% } else if (article.status === 'approved') { %>
                <span class="approved">‚úî Approved</span>
              <% } else if (article.status === 'declined') { %>
                <span class="declined">‚úñ Declined</span>
              <% } %>
            </li>
          <% }) %>
        </ul>
      </div>

      <!-- Certificates Card -->
      <div class="card">
        <h2>Manage Certificates</h2>
        <ul>
          <% certificates.forEach(cert => { %>
            <li>
              <%= cert.number %> - <%= cert.recipientName %>
              <% if (cert.isApproved) { %>
                <span style="color:green;">‚úî Approved</span>
              <% } else { %>
                <span style="color:red;">‚ùå Not Approved</span>
              <% } %>
              <form action="/admin/certificates/<%= cert._id %>/toggle" method="POST" style="display:inline;">
                <button type="submit">Toggle Approval</button>
              </form>
            </li>
          <% }) %>
        </ul>
      </div>
      <div>
        <h3>Upload Certificate</h3>
        <form method="POST" action="/certificates/upload" enctype="multipart/form-data">
          <input type="text" name="number" placeholder="Certificate Number" required />
          <input type="text" name="recipientName" placeholder="Recipient Name" required />
          <input type="date" name="issueDate" required />
          <input type="file" name="certificateFile" accept=".pdf,.doc,.docx" required />
          <button type="submit">Upload Certificate</button>
        </form>       
      </div>
    </div>
  </div>
</section>

<%- include('partials/footer') %>
