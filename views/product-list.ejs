<%- include('partials/header', { title: 'Shop', active: 'shop' }) %>

<%- include('partials/seo', {
  title: 'Buyhatke Shop - Candles',
  description: 'Browse our collection of handcrafted candles for home, gifts, and special occasions.',
  keywords: 'candles, scented candles, gift candles, Buyhatke',
  path: '/shop'
}) %>

<section class="shop-section container">
  <h1>Shop Candles</h1>

  <!-- Search Form -->
  <form method="GET" action="/products" class="search-form">
    <input type="text" name="search" placeholder="Search candles..." value="<%= search %>" />
    <button type="submit">Search</button>
  </form>

  <!-- Category Filter -->
  <form method="GET" action="/products">
    <select name="category" onchange="this.form.submit()">
      <option value="">All Categories</option>
      <% if (categories && categories.length > 0) { %>
        <% categories.forEach(cat => { %>
          <option value="<%= cat.name %>" <%= selectedCategory === cat.name ? 'selected' : '' %>>
            <%= cat.name %>
          </option>
        <% }) %>
      <% } %>
    </select>
  </form>

  <!-- Products Grid -->
  <% if (categories && categories.length > 0) { %>
  <% categories.forEach(cat => { 
       const catProducts = products.filter(p => p.category === cat.name);
       if (catProducts.length === 0) return;
  %>
    <h2 class="category-title"><%= cat.name %></h2>
    <div class="category-row">
      <% catProducts.forEach(product => { %>
        <div class="product-card">
          <div class="product-thumb">
            <img src="/uploads/products/<%= product.image %>" alt="<%= product.name %>" class="product-img" />
          </div>
          <h3><%= product.name %></h3>
          <p class="price">â‚¹<%= product.price %></p>
          <a href="/products/<%= product._id %>" class="btn btn-secondary">View</a>
        </div>
      <% }) %>
    </div>
  <% }) %>
<% } else { %>
  <p>No products found.</p>
<% } %>
</section>

<%- include('partials/footer') %>


<style>
.category-row {
  display: flex;
  overflow-x: auto;
  gap: 16px;
  padding: 10px 0;
}
.category-row::-webkit-scrollbar {
  height: 8px;
}
.category-row::-webkit-scrollbar-thumb {
  background-color: #888;
  border-radius: 4px;
}
.category-row::-webkit-scrollbar-track {
  background: #f1f1f1;
}
.product-card {
  flex: 0 0 auto;
  width: 200px;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 10px;
  text-align: center;
}
</style>
